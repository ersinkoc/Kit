<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Core Module - @oxog/kit</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="../" class="nav-logo">@oxog/kit</a>
      <ul class="nav-menu">
        <li><a href="../#getting-started">Getting Started</a></li>
        <li><a href="../#modules">Modules</a></li>
        <li><a href="./">API Reference</a></li>
        <li><a href="../guides/">Guides</a></li>
        <li><a href="https://github.com/oxog/kit" target="_blank">GitHub</a></li>
      </ul>
    </div>
  </nav>

  <main class="container api-content">
    <div class="api-layout">
      <aside class="api-sidebar">
        <ul>
          <li><a href="#logging">Logging</a></li>
          <li><a href="#events">Events</a></li>
          <li><a href="#config">Configuration</a></li>
          <li><a href="#context">Context</a></li>
          <li><a href="#errors">Errors</a></li>
        </ul>
      </aside>

      <div class="api-main">
        <div class="api-header">
          <h1>@oxog/kit/core</h1>
          <p>Configuration, logging, events, context, and error utilities</p>
        </div>

        <section class="api-section" id="logging">
          <h2>Logging</h2>
          <p>Structured logging with levels and formatters</p>

          <div class="api-function">
            <h4>log</h4>
            <p>Default logger instance</p>
            <pre><code>import { log } from '@oxog/kit/core';

// Log at different levels
log.debug('Debug message', { detail: 'value' });
log.info('User logged in', { userId: '123' });
log.warn('Rate limit approaching', { current: 95, max: 100 });
log.error('Database connection failed', { error: err.message });

// Output (JSON format):
// {"level":"info","message":"User logged in","userId":"123","timestamp":"2024-01-15T10:30:00.000Z"}</code></pre>
          </div>

          <div class="api-function">
            <h4>createLogger(options?: LoggerOptions): Logger</h4>
            <p>Create a custom logger</p>
            <pre><code>import { createLogger } from '@oxog/kit/core';

const logger = createLogger({
  level: 'info',           // Minimum level to log
  format: 'json',          // 'json' or 'pretty'
  timestamp: true,         // Include timestamp
  context: {               // Default context for all logs
    service: 'my-app',
    version: '1.0.0',
  },
});

logger.info('Starting server', { port: 3000 });</code></pre>
          </div>

          <div class="api-function">
            <h4>logger.child(context): Logger</h4>
            <p>Create child logger with additional context</p>
            <pre><code>const requestLogger = log.child({
  requestId: req.id,
  userId: req.user?.id,
});

requestLogger.info('Processing request');
// All logs include requestId and userId</code></pre>
          </div>

          <div class="api-function">
            <h4>Log Levels</h4>
            <p>Available logging levels in order of severity</p>
            <ul>
              <li><code>debug</code> - Detailed debugging information</li>
              <li><code>info</code> - General information</li>
              <li><code>warn</code> - Warning messages</li>
              <li><code>error</code> - Error messages</li>
              <li><code>fatal</code> - Critical errors</li>
            </ul>
          </div>
        </section>

        <section class="api-section" id="events">
          <h2>Events</h2>
          <p>Type-safe event emitter</p>

          <div class="api-function">
            <h4>createEventEmitter&lt;Events&gt;(): EventEmitter&lt;Events&gt;</h4>
            <p>Create a type-safe event emitter</p>
            <pre><code>import { createEventEmitter } from '@oxog/kit/core';

// Define event types
interface MyEvents {
  userCreated: { id: string; name: string };
  userDeleted: { id: string };
  error: Error;
}

const emitter = createEventEmitter&lt;MyEvents&gt;();

// Type-safe listeners
emitter.on('userCreated', (data) => {
  console.log(`User created: ${data.name}`); // data is typed
});

// One-time listener
emitter.once('userCreated', (data) => {
  console.log('First user!');
});

// Emit events (type-checked)
emitter.emit('userCreated', { id: '123', name: 'John' });

// Remove listener
const unsubscribe = emitter.on('error', handleError);
unsubscribe(); // or emitter.off('error', handleError);</code></pre>
          </div>

          <div class="api-function">
            <h4>emitter.on(event, listener): () => void</h4>
            <p>Add event listener. Returns unsubscribe function.</p>
          </div>

          <div class="api-function">
            <h4>emitter.once(event, listener): () => void</h4>
            <p>Add one-time event listener</p>
          </div>

          <div class="api-function">
            <h4>emitter.off(event, listener): void</h4>
            <p>Remove event listener</p>
          </div>

          <div class="api-function">
            <h4>emitter.emit(event, data): void</h4>
            <p>Emit event with data</p>
          </div>

          <div class="api-function">
            <h4>emitter.removeAllListeners(event?): void</h4>
            <p>Remove all listeners for event, or all listeners</p>
          </div>
        </section>

        <section class="api-section" id="config">
          <h2>Configuration</h2>
          <p>Type-safe configuration management</p>

          <div class="api-function">
            <h4>createConfig&lt;T&gt;(defaults: T): Config&lt;T&gt;</h4>
            <p>Create a configuration manager</p>
            <pre><code>import { createConfig } from '@oxog/kit/core';

interface AppConfig {
  port: number;
  host: string;
  database: {
    url: string;
    pool: number;
  };
}

const config = createConfig&lt;AppConfig&gt;({
  port: 3000,
  host: 'localhost',
  database: {
    url: 'postgres://localhost/db',
    pool: 10,
  },
});

// Get values
const port = config.get('port');                    // 3000
const dbUrl = config.get('database.url');           // Nested access
const missing = config.get('nonexistent', 'default'); // With default

// Set values
config.set('port', 8080);
config.set('database.pool', 20);

// Load from environment variables
config.loadEnv({
  PORT: 'port',                    // PORT -> port
  DATABASE_URL: 'database.url',    // DATABASE_URL -> database.url
});

// Load from file
await config.loadFile('./config.json');

// Validate configuration
config.validate((c) => {
  if (c.port < 1 || c.port > 65535) {
    throw new Error('Invalid port');
  }
});</code></pre>
          </div>

          <div class="api-function">
            <h4>config.get(path, defaultValue?): any</h4>
            <p>Get configuration value by path</p>
          </div>

          <div class="api-function">
            <h4>config.set(path, value): void</h4>
            <p>Set configuration value</p>
          </div>

          <div class="api-function">
            <h4>config.has(path): boolean</h4>
            <p>Check if path exists</p>
          </div>

          <div class="api-function">
            <h4>config.all(): T</h4>
            <p>Get entire configuration object</p>
          </div>
        </section>

        <section class="api-section" id="context">
          <h2>Context</h2>
          <p>Request context propagation</p>

          <div class="api-function">
            <h4>createContext&lt;T&gt;(): Context&lt;T&gt;</h4>
            <p>Create a context for async local storage</p>
            <pre><code>import { createContext } from '@oxog/kit/core';

interface RequestContext {
  requestId: string;
  userId?: string;
  startTime: number;
}

const requestContext = createContext&lt;RequestContext&gt;();

// Run code with context
await requestContext.run(
  { requestId: 'req-123', startTime: Date.now() },
  async () => {
    // Anywhere in this async call tree:
    const ctx = requestContext.get();
    console.log(ctx.requestId); // 'req-123'

    await someAsyncOperation();

    // Still accessible
    const ctx2 = requestContext.get();
    console.log(ctx2.requestId); // 'req-123'
  }
);

// Use in middleware
function middleware(req, res, next) {
  requestContext.run(
    { requestId: req.id, userId: req.user?.id, startTime: Date.now() },
    () => next()
  );
}</code></pre>
          </div>

          <div class="api-function">
            <h4>context.run(value, fn): Promise&lt;T&gt;</h4>
            <p>Run function with context value</p>
          </div>

          <div class="api-function">
            <h4>context.get(): T | undefined</h4>
            <p>Get current context value</p>
          </div>

          <div class="api-function">
            <h4>context.getStore(): T | undefined</h4>
            <p>Alias for get()</p>
          </div>
        </section>

        <section class="api-section" id="errors">
          <h2>Errors</h2>
          <p>Custom error classes and utilities</p>

          <div class="api-function">
            <h4>AppError</h4>
            <p>Base application error class</p>
            <pre><code>import { AppError } from '@oxog/kit/core';

throw new AppError('Something went wrong', {
  code: 'ERR_SOMETHING',
  statusCode: 500,
  cause: originalError,
  context: { userId: '123' },
});</code></pre>
          </div>

          <div class="api-function">
            <h4>ValidationError</h4>
            <p>Validation error with field details</p>
            <pre><code>import { ValidationError } from '@oxog/kit/core';

throw new ValidationError('Invalid input', {
  fields: {
    email: 'Invalid email format',
    age: 'Must be a positive number',
  },
});</code></pre>
          </div>

          <div class="api-function">
            <h4>NotFoundError</h4>
            <p>Resource not found error</p>
            <pre><code>import { NotFoundError } from '@oxog/kit/core';

throw new NotFoundError('User not found', {
  resource: 'User',
  id: '123',
});</code></pre>
          </div>

          <div class="api-function">
            <h4>isAppError(error): boolean</h4>
            <p>Check if error is an AppError</p>
          </div>

          <div class="api-function">
            <h4>wrapError(error, message?): AppError</h4>
            <p>Wrap any error in AppError</p>
            <pre><code>import { wrapError } from '@oxog/kit/core';

try {
  await riskyOperation();
} catch (error) {
  throw wrapError(error, 'Failed to complete operation');
}</code></pre>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>@oxog/kit - MIT License</p>
    </div>
  </footer>

  <script src="../js/main.js"></script>
</body>
</html>
